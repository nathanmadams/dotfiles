#!/bin/bash
if [ -z $1 ]; then
    echo "A destination box name must be provided"
    exit 1
fi

DEST_BOX=$1
HOME_DIR="/base/data/nadams"

echo -n "Copying ssh key to arbux ssh_public_root..."
scp -rq ~/.ssh/id_rsa.pub root@${DEST_BOX}:/base/store/ssh/ssh_public_root
echo "done."
echo

echo -n "Creating home directory and copying .ssh files..."
ssh root@${DEST_BOX} -n "mkdir -p $HOME_DIR"
ssh root@${DEST_BOX} -n "mkdir -p $HOME_DIR/.ssh/"
scp -q ~/.ssh/id_rsa.pub ~/.ssh/known_hosts ~/.ssh/config root@${DEST_BOX}:$HOME_DIR/.ssh/
ssh root@${DEST_BOX} -n "chmod -R 600 $HOME_DIR/.ssh"
echo "done."
echo

ssh root@${DEST_BOX} -n "HOME=$HOME_DIR && cd ~ && git clone git@git.arbor.net:/nadams/dotfiles && source dotfiles/install.sh"
echo

ssh root@${DEST_BOX} -n "HOME=/data/nadams SHELL=/bin/bash chroot /base bash -cl 'setup_vim'"
